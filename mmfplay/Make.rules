# $Id: Make.rules,v 1.6 2004/06/30 13:11:31 cmatsuoka Exp $

CC	= gcc
CFLAGS	= -g -O0 -Wall
LD	= gcc
LDFLAGS	= -g
RANLIB	= ranlib
SHELL	= /bin/sh
CONF	= $(TOPDIR)/Make.conf
MAKEFILE= Makefile


include $(CONF)

.c.o:
	$(CC) -c $(CFLAGS) $(XCFLAGS) $(XXCFLAGS) -o$*.o $<

dummy:

distclean::
	rm -f $(DCFILES)

clean distclean::
	rm -f *.o *.obj errlist core depend $(CFILES)
ifdef DDIRS
	@for i in $(DDIRS); do \
		(cd $$i; [ -f $(MAKEFILE) ] && $(MAKE) $@) \
	done; true
endif

subdirs:
ifdef DDIRS
	@for i in $(DDIRS); do \
		(cd $$i; [ -f $(MAKEFILE) ] && $(MAKE) all) \
	done; true
endif

$(OBJS): $(MAKEFILE) $(CONF)

$(LIB): $(LIB)($(OBJS))
	$(RANLIB) $(LIB)

$(LIB): $(OBJS)

subdist:
	cp -dp $(DFILES) $(XDFILES) $(DISTDIR)
ifdef DDIRS
	for i in $(DDIRS) $(XDDIRS); do \
		mkdir $(DISTDIR)/$$i; \
		( cd $$i; \
		if [ -f $(MAKEFILE) ]; then \
			$(MAKE) VERSION=$(VERSION) DISTDIR=../$(DISTDIR)/$$i \
			subdist; \
		else \
			for j in *; do \
				[ -f $$j ] && cp -dp $$j ../$(DISTDIR)/$$i; \
			done; \
		fi; ) \
	done
endif

depend: $(MAKEFILE)
	@echo Building dependencies...
	@$(CC) $(CFLAGS) $(XCFLAGS) $(XXCFLAGS) -M $(OBJS:.o=.c) $(XDEPS) >$@

# Poor man's autoconf
$(CONF):
	@rm -f $@
	@case `uname -o` in				\
	*Linux)						\
		SOUND=oss;				\
		echo "XXCFLAGS=-DHAS_GETOPT_LONG">>$@;;	\
	Solaris)					\
		SOUND=solaris;;				\
	esac;						\
	echo "SOUND_DRIVER=$$SOUND">>$@;		\
	echo "USERNAME=`whoami`@`hostname`">>$@
	
include $(TOPDIR)/Version

ifdef OBJS
include depend
endif

