# $Id: Make.rules,v 1.4 2004/06/30 03:36:43 cmatsuoka Exp $

CC	= gcc
CFLAGS	= -g -O0 -Wall
LD	= gcc
LDFLAGS	= -g
RANLIB	= ranlib
SHELL	= /bin/sh


include $(TOPDIR)/Make.conf

.c.o:
	$(CC) -c $(CFLAGS) $(XCFLAGS) -o$*.o $<

dummy:

distclean::
	rm -f $(DCFILES)

clean distclean::
	rm -f *.o *.obj errlist core depend $(CFILES)
ifdef DDIRS
	@for i in $(DDIRS); do \
		(cd $$i; [ -f $(MAKEFILE) ] && $(MAKE) $@) \
	done; true
endif

subdirs:
ifdef DDIRS
	@for i in $(DDIRS); do \
		(cd $$i; [ -f $(MAKEFILE) ] && $(MAKE) all) \
	done; true
endif

$(OBJS): Makefile

$(LIB): $(LIB)($(OBJS))
	$(RANLIB) $(LIB)

$(LIB): $(OBJS)

subdist:
	cp -dp $(DFILES) $(XDFILES) $(DISTDIR)
ifdef DDIRS
	for i in $(DDIRS) $(XDDIRS); do \
		mkdir $(DISTDIR)/$$i; \
		( cd $$i; \
		if [ -f Makefile ]; then \
			$(MAKE) VERSION=$(VERSION) DISTDIR=../$(DISTDIR)/$$i \
			subdist; \
		else \
			for j in *; do \
				[ -f $$j ] && cp -dp $$j ../$(DISTDIR)/$$i; \
			done; \
		fi; ) \
	done
endif

depend: Makefile
	@echo Building dependencies...
	@$(CC) $(CFLAGS) $(XCFLAGS) -M $(OBJS:.o=.c) $(XDEPS) >$@

Make.conf:
	@case `uname -o` in			\
	  *Linux)	SOUND=oss;;		\
	  Solaris)	SOUND=solaris;;		\
	esac;					\
	echo "SOUND_DRIVER=$$SOUND" >$@;	\
	echo "USERNAME=`whoami`@`hostname`">>$@
	
include $(TOPDIR)/Version

ifdef OBJS
include depend
endif


